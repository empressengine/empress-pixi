(function(h,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("empress-core"),require("pixi.js"),require("@pixi/layers"),require("@pixi/particle-emitter"),require("pixi-spine")):typeof define=="function"&&define.amd?define(["exports","empress-core","pixi.js","@pixi/layers","@pixi/particle-emitter","pixi-spine"],l):(h=typeof globalThis<"u"?globalThis:h||self,l(h.EmpressPixi={},h.empressCore,h.pixi_js,h.PixiLayers,h.particles,h.pixiSpine))})(this,function(h,l,u,U,Bt,V){"use strict";function nt(n){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const e in n)if(e!=="default"){const i=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,i.get?i:{enumerable:!0,get:()=>n[e]})}}return t.default=n,Object.freeze(t)}const Pt=nt(U),Ot=nt(Bt);class x{constructor(){this._groups=new Map,this._layers=new Map}setStage(t){this._stage=t}createGroups(t,e,i){var o;const s=new U.Group(e,i),r=new U.Layer(s);r.name=t,this._groups.set(t,s),this._layers.set(t,r),(o=this._stage)==null||o.addChild(r)}getGroup(t){return this._groups.get(t)}setLayer(t,e){const i=this._groups.get(t);i&&(e.parentGroup=i,this.sort(t))}setOrder(t,e){t.zOrder=e}sort(t){var i,s;(i=this._stage)==null||i.sortChildren(),(s=this._stage)==null||s.updateStage();const e=this._layers.get(t);e&&e.sortChildren()}sortAll(){var t,e;(t=this._stage)==null||t.sortChildren(),(e=this._stage)==null||e.updateStage(),Array.from(this._layers.values()).forEach(i=>{i.sortChildren()})}}class Dt{constructor(t){this._assetsManager=t}build(t,e,i){const s=i[t],r=s.textures;for(let o in s.animations){this._assetsManager.add(t);const c=s.animations[o];this._assetsManager.updateOnLoad(t,[{name:o,asset:c,bundle:e}])}for(let o in r)this._assetsManager.updateOnLoad(e,[{name:o,asset:r[o],bundle:e}])}}class Wt{constructor(t){this._assetsManager=t}build(t,e,i){this._assetsManager.updateOnLoad(e,[{name:t,asset:i[t],bundle:e}])}}class Lt{constructor(t){this._assetsManager=t}build(t,e,i){const s=new u.BitmapFontData,r=i[t],o={dot:".",comma:",",usd:"$",eur:"â‚¬",space:" ",dash:"-",plus:"+"},c=r.data.frames,a=Object.keys(c).map((d,_)=>{s.page.push({id:_,file:""});const v=(d.length>1?o[d]:d).charCodeAt(0),I=r.textures[d];return s.char.push({id:v,page:_,x:0,y:0,width:I.width,height:I.height,xoffset:0,yoffset:0,xadvance:I.width}),I});s.common[0]={lineHeight:a[0].height},s.info[0]={face:t,size:a[0].height};const w=new u.BitmapFont(s,a,!0);u.BitmapFont.available[t]=w}}class Ft{constructor(t){this._assetsManager=t}build(t,e,i){this._assetsManager.updateOnLoad(e,[{name:t,asset:i[t].spineData,bundle:e}])}}class H{constructor(t){this._assetsManager=t,this._dimension="",this._behaviours=new Map,this.closestDimension=e=>{const i=window.screen.height*window.devicePixelRatio,s=window.screen.width*window.devicePixelRatio,r=i>s?i:s,o=e.map(d=>Math.abs(r-d.width));let c=o[0],a=0;return o.map((d,_)=>{d<c&&(c=d,a=_)}),e[a].alias}}get dimension(){return this._dimension}async init(t){const{bundles:e}=t.manifest,i=await this.checkWebPSupport();this._dimension=this.closestDimension(t.resolutions),t.ignoreFormats&&this.ignoreFormats(e,t.ignoreFormats),this.selectResolution(e,this._dimension),this.selectWebp(e,i),this.setupBehaviours(),u.Assets.setPreferences({preferCreateImageBitmap:!1,preferWorkers:!1}),await u.Assets.init({manifest:{bundles:e}})}async loadBundle(t){return this._assetsManager.add(t),u.Assets.loadBundle(t).then(e=>{this.processBundle(t,e)})}processBundle(t,e){for(let i in e){let s;e[i].hasOwnProperty("spineData")?s=this._behaviours.get("spine"):e[i]instanceof u.Texture?s=this._behaviours.get("texture"):e[i]instanceof u.Spritesheet?s=this._behaviours.get("spritesheet"):t==="fonts"&&(s=this._behaviours.get("bitmap")),s&&s.build(i,t,e)}}setupBehaviours(){this._behaviours.set("spritesheet",new Dt(this._assetsManager)),this._behaviours.set("texture",new Wt(this._assetsManager)),this._behaviours.set("bitmap",new Lt(this._assetsManager)),this._behaviours.set("spine",new Ft(this._assetsManager))}checkWebPSupport(){return new Promise(t=>{const e=new Image;e.onload=e.onerror=()=>{t(e.height===2)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})}selectResolution(t,e){for(let i of t)for(let s of i.assets)if(Array.isArray(s.srcs)){const r=s.srcs.filter(o=>o.includes(e));r&&r.length&&(s.srcs=r)}}selectWebp(t,e){for(let i of t)for(let s of i.assets)if(Array.isArray(s.srcs)){const r=e?s.srcs.find(o=>o.includes("_webp")):s.srcs.find(o=>!o.includes("_webp"));r&&(s.srcs=r)}}ignoreFormats(t,e){for(let i of t){for(let s of i.assets){if(!Array.isArray(s.srcs))continue;const r=s.srcs.some(o=>e.some(c=>o.includes(`.${c}`)));i.assets=i.assets.filter(()=>!r)}if(i.assets.length==0){const s=t.indexOf(i);t.splice(s,1)}}}}class W{constructor(){this._emitters=new Map}createParticleEmitter(t,e,i){const s=new Ot.Emitter(e,i);return this._emitters.set(t,s),s}update(t){Array.from(this._emitters.values()).forEach(i=>{i.update(t)})}emit(t){const e=this._emitters.get(t);e&&(e.emit=!0)}emitAll(){Array.from(this._emitters.values()).forEach(e=>{e.emit=!0})}}const rt=new l.Signal;var E=(n=>(n.Pending="Pending",n.Loaded="Loaded",n))(E||{});class ot extends l.Entity{get active(){return this.getComponent(u.Container).visible}set active(t){const e=this.getComponent(u.Container);e.visible=t}}class L{constructor(){this._list=new Map}add(t,e){this._list.set(t,e)}get(t){return this._list.get(t)||null}getInChildren(t){const e=[];for(let i=0;i<t.children.length;i++){const s=t.children[i],r=this.get(s);r&&e.push(r);const o=this.getInChildren(s);e.push(...o)}return e}getInChildrenByFilter(t,e){const i=[];return this.getInChildren(t).forEach(r=>{r.isSatisfiedFilter(e)&&i.push(r)}),i}getComponent(t,e){const i=this.get(t);if(!i)throw new Error(`Entity not found for view: ${t.name}`);return i.getComponent(e)}}const at=new l.Signal;class T{setCommonData(t,e){if(e.name=t.name,e.alpha=t.alpha===void 0?1:t.alpha,e.angle=t.angle||0,e.rotation=t.rotation||0,e.zIndex=t.zIndex||0,e.zOrder=t.zOrder||0,e.visible=t.visible!==void 0?t.visible:!0,e.sortableChildren=!!t.sortableChildren,t.position&&(e.position={x:t.position.x||0,y:t.position.y||0}),t.relativePosition&&this.setRelativePosition(t.relativePosition,e),t.scale&&(e.scale={x:t.scale.x||1,y:t.scale.y||1}),t.pivot&&(e.pivot={x:t.pivot.x||0,y:t.pivot.y||0}),t.width&&(e.width=t.width),t.height&&(e.height=t.height),t.hitArea&&(e.hitArea=t.hitArea),t.parentGroup){const s=l.ServiceContainer.instance.get(x);e.parentGroup=s.getGroup(t.parentGroup)}let i=null;if(t.entity&&(i=this.setEntity(t.entity,e)),t.mask&&this.setMask(t.mask,e),t.interactive&&(e.eventMode=t.interactive.eventMode||"static",e.cursor=t.interactive.cursor||"pointer",t.interactive.emit.forEach(s=>e.on(s,()=>{at.dispatch({type:s,view:e,entity:i})}))),t.interactiveChildren!==void 0&&(e.interactiveChildren=t.interactiveChildren),t.debugBorder){const s=t.debugBorderColor||16711680,r=t.debugBorderWidth||1;this.setDebugBorder(e,r,s)}}setAnchor(t,e){const s=t||{x:.5,y:.5},r=s.x===void 0?.5:s.x,o=s.y===void 0?.5:s.y;e.anchor.set(r,o)}setRelativePosition(t,e){const i=l.ServiceContainer.instance.get(u.Application),{width:s,height:r}=i.renderer.screen,o=t.x||0,c=t.y||0,a=s/2*o,w=r/2*c;e.position.set(a,w)}setMask(t,e){const{x:i,y:s,type:r}=t,o=new u.Graphics;if(o.beginFill(t.color||16777215),r==="rect"){let{width:c,height:a}=t;c||(c=i),a||(a=s),o.drawRect(i,s,i+c,s+a),o.pivot.x=c/2,o.pivot.y=a/2}else r==="circle"&&(o.drawCircle(i,s,t.radius||1),o.x=e.width/2,o.y=e.height/2);o.endFill(),t.isDebug||(e.mask=o),e.addChild(o)}setEntity(t,e){const i=t.instance?t.instance(e):new ot(l.Utils.uuid(),`Entity-${e.name}`),s=t.components||[];this.setComponents(i,[e,...s]);const r=l.ServiceContainer.instance.get(l.EntityStorage),o=l.ServiceContainer.instance.get(L);return r.addEntity(i),o.add(e,i),e.on("destroyed",()=>{r.removeEntity(i.uuid)}),i}setComponents(t,e){e.forEach(i=>t.addComponent(i))}setDebugBorder(t,e,i){const s=new u.Graphics;s.lineStyle(e,i,e).drawRect(-e,-e,t.width+e,t.height+e),s.pivot.x=t.width/2,s.pivot.y=t.height/2,t.addChild(s)}}class Rt extends T{create(t){const e=new u.Container;return this.setCommonData(t,e),e}}class ct{constructor(t){this._name=t,this.data=[],this.status=E.Pending,this._loaded=new Promise(e=>this._resolve=e)}get name(){return this._name}get loaded(){return this._loaded}get resolve(){return this._resolve}getAssetByName(t){const e=typeof t=="string"?t:t.name;return this.data.find(i=>i.name===e)}}class C{constructor(){this.list=new Map}add(t){const e=new ct(t);this.list.set(t,e)}updateOnLoad(t,e){const i=this.list.get(t);i&&(i.data.push(...e),i.status=E.Loaded,i.resolve(i))}getBundle(t){let e;return typeof t=="string"?e=this.findParentBundle(t):e=this.list.get(t.bundle),e}getAsset(t){const e=this.getBundle(t);if(e)return e==null?void 0:e.getAssetByName(t)}hasAsset(t){const e=this.getBundle(t);return!!(e!=null&&e.getAssetByName(t))}findParentBundle(t){const s=Array.from(this.list.values()).flatMap(r=>r.data).find(r=>r.name===t);if(s)return this.list.get(s.bundle)}}class qt extends T{create(t){const i=l.ServiceContainer.instance.get(C).getAsset(t.asset);if(!i)throw new Error(`Asset ${t.asset.toString()} not found!`);const s=i.asset,r=new u.Sprite;return r.texture=s,r.tint=t.tint?t.tint:16777215,this.setCommonData(t,r),this.setAnchor(t.anchor,r),r}}class zt extends T{create(t){const e=new u.BitmapText(t.text,t.bitmapTextStyle);return this.setCommonData(t,e),this.setAnchor(t.anchor,e),e.tint=t.tint?t.tint:16777215,e}}class Nt extends T{create(t){const e=new u.TextStyle(t.textStyle||{}),i=new u.Text(t.text,e);return this.setCommonData(t,i),this.setAnchor(t.anchor,i),i}}class $t{constructor(t,e){this._name=t,this._spineController=e,this._timescaleModifier=0,this._timeScaleMiltiplier=1,this._chain=[],this._curent=null,this._listener=null,this._originalTimeScale=0}get current(){return this._curent}get promises(){return this._chain.map(({deferredPromise:t})=>t)}add(t,e,i={loopCount:1,timeScale:1}){const s=[];if(i.loopCount===void 0&&(i.loopCount=1),i.timeScale===void 0&&(i.timeScale=1),i.loopCount!==-1)for(let r=0;r<i.loopCount;r++){const o=new l.DeferredPromise;s.push({spine:t,name:e,options:i,deferredPromise:o})}else{const r=new l.DeferredPromise;s.push({spine:t,name:e,options:i,deferredPromise:r}),console.warn("[SpineChainsUtil]: loopCount -1 looped your animation forever!")}return this._chain.push(...s),this}async play(){for(;this._chain.length>0;){const t=this._curent=this._chain[0],{spine:e,name:i,deferredPromise:s,options:r}=t,{loopCount:o,timeScale:c}=r;o===-1&&this.add(e,i,r),e.state.timeScale=c||0,this._originalTimeScale=e.state.timeScale,c&&(e.state.timeScale=(c+this._timescaleModifier)*this._timeScaleMiltiplier),this._listener&&e.state.removeListener(this._listener),this.clear(e),this._listener=this.setListener(r,s),e.state.addListener(this._listener),e.state.setAnimation(0,i,!1),await s.promise,this._chain.shift()}this._spineController.remove(this._name)}stop(t=!1){t&&this._chain.forEach(i=>this.clear(i.spine));const e=this.promises;l.DeferredPromise.resolveAll(e,void 0),this._chain.length=0,this._spineController.remove(this._name)}multiplyTimeScale(t){this._curent&&(t<=0&&(t=1),this._timeScaleMiltiplier=t,this._curent.spine.state.timeScale=(this._originalTimeScale+this._timescaleModifier)*t)}increaseTimeScale(t){this._curent&&(this._timescaleModifier=t,this._curent.spine.state.timeScale+=t)}decreaseTimeScale(t){this._curent&&(this._timescaleModifier=0,this._curent.spine.state.timeScale-=t)}pause(){this._curent&&(this._originalTimeScale=this._curent.spine.state.timeScale,this._curent.spine.state.timeScale=0)}resume(){this._curent&&(this._curent.spine.state.timeScale=this._originalTimeScale+this._timescaleModifier)}setListener(t,e){return{start:i=>{t.start&&t.start(i)},interrupt:i=>{t.interrupt&&t.interrupt(i)},end:i=>{t.end&&t.end(i)},dispose:i=>{t.dispose&&t.dispose(i)},complete:i=>{t.complete&&t.complete(i),e.resolve(!0)},event:(i,s)=>{t.event&&t.event(i,s)}}}clear(t){t.state.clearTracks(),t.state.tracks=[],t.skeleton.setToSetupPose(),this._listener&&t.state.removeListener(this._listener),t.lastTime=null}}class F{constructor(){this._chains=new Map}get _spineChains(){return Array.from(this._chains.values())}create(t){const e=new $t(t,this);return this._chains.set(t,e),e}get(t){return this._chains.get(t)}remove(t){this._chains.has(t)&&this._chains.delete(t)}removeAll(){for(const[t]of this._chains.entries())this.remove(t)}multyplyTimeScaleAll(t){this._spineChains.forEach(e=>e.multiplyTimeScale(t))}multyplyTimeScale(t,e){const i=this.get(t);i==null||i.multiplyTimeScale(e)}increaseTimeScaleAll(t){this._spineChains.forEach(e=>e.increaseTimeScale(t))}increaseTimeScale(t,e){const i=this.get(t);i==null||i.increaseTimeScale(e)}decreaseTimeScaleAll(t){this._spineChains.forEach(e=>e.decreaseTimeScale(t))}decreaseTimeScale(t,e){const i=this.get(t);i==null||i.decreaseTimeScale(e)}pauseAll(){this._spineChains.forEach(t=>t.pause())}pause(t){const e=this.get(t);e==null||e.pause()}resumeAll(){this._spineChains.forEach(t=>t.resume())}resume(t){const e=this.get(t);e==null||e.resume()}stopAll(t=!1){this._spineChains.forEach(e=>e.stop(t))}stop(t,e=!1){const i=this.get(t);i==null||i.stop(e)}}class X{getDuration(t,e){const i=t.spineData.findAnimation(e);if(i===null)throw Error(`[SpineChainsUtil]: Animation ${e} not found`);return i.duration}findSlotIndex(t,e){return t.skeleton.findSlotIndex(e)}findSlotByName(t,e){const i=this.findSlotIndex(t,e);return t.slotContainers[i].children[0]}setSlotAlpha(t,e,i){const s=t.skeleton.findSlot(e);s.currentSprite.alpha=i}addToSlot(t,e,i){this.findSlotByName(t,e).addChild(i)}setSkin(t,e){const i=t.skeleton.data.findSkin(e);if(!i)throw Error(`[SpineChainsUtil]: Skin ${e} not found`);t.skeleton.skin=i,t.skeleton.setSlotsToSetupPose(),t.state.apply(t.skeleton)}}class Gt extends T{create(t){const e=l.ServiceContainer.instance.get(C),i=l.ServiceContainer.instance.get(F),s=e.getAsset(t.asset);if(!s)throw new Error(`Asset ${t.asset.toString()} not found!`);const r=s.asset,o=new V.Spine(r);if(t.initialAnimation&&o.state.hasAnimation(t.initialAnimation)){const c=`${t.key||""}:${t.name}`;i.create(c).add(o,t.initialAnimation,{timeScale:t.timeScale,loopCount:t.loop}).play(),o.autoUpdate=!0}return t.skin&&o.skeleton.data.findSkin(t.skin)&&(o.skeleton.setSkinByName(t.skin),o.skeleton.setSlotsToSetupPose()),this.setCommonData(t,o),o}}class Ut extends T{create(t){const i=l.ServiceContainer.instance.get(C).getAsset(t.asset);if(!i)throw new Error(`Asset ${t.asset.toString()} not found!`);const s=i.asset,r=new u.NineSlicePlane(s,t.leftWidth,t.topHeight,t.rightWidth,t.bottomHeight);return r.tint=t.tint?t.tint:16777215,this.setCommonData(t,r),r}}class R{constructor(t){this._assetsManager=t,this._behaviours=new Map,this.setupBehaviours()}create(t,e){const i=this._behaviours.get(t.type);if(!i)throw new Error(`Unsupported type: ${t.type}`);if(e?this.loadLazyAsset(t,e):!1)return;const r=i.create(t);return e==null||e.addChild(r),rt.dispatch(r),t.children&&this.createChildren(t.children,r),r}setupBehaviours(){this._behaviours.set(u.Container,new Rt),this._behaviours.set(u.Sprite,new qt),this._behaviours.set(u.BitmapText,new zt),this._behaviours.set(u.Text,new Nt),this._behaviours.set(V.Spine,new Gt),this._behaviours.set(u.NineSlicePlane,new Ut)}createChildren(t,e){for(let i=0;i<t.length;i++){const s=t[i];this.create(s,e)}}loadLazyAsset(t,e){let i=!1;if("asset"in t){const s=this._assetsManager.getBundle(t.asset);if(!s)throw new Error("No such asset"+t.asset.toString());s.status===E.Pending&&(s.loaded.then(()=>{this.create(t,e)}),i=!0)}return i}}class b{constructor(t){t&&(this._config=t)}node(t,e="node"){return this._config?this._config.type=t:this._config={type:t,name:e},this}view(t){return this._config=t.create(),this}config(t){return this._config=t,this}name(t){return this.checkConfig(),this._config.name=t,this}position(t,e){return this.checkConfig(),this._config.position={x:t,y:e},this}x(t){return this.checkConfig(),this._config.position={x:t},this}y(t){return this.checkConfig(),this._config.position={y:t},this}scale(t,e){return this.checkConfig(),this._config.scale={x:t,y:e},this}scaleX(t){return this.checkConfig(),this._config.scale={x:t},this}scaleY(t){return this.checkConfig(),this._config.scale={y:t},this}width(t){return this.checkConfig(),this._config.width=t,this}height(t){return this.checkConfig(),this._config.height=t,this}size(t,e){return this.checkConfig(),this._config.width=t,this._config.height=e,this}pivot(t,e){return this.checkConfig(),this._config.pivot={x:t,y:e},this}visible(t){return this.checkConfig(),this._config.visible=t,this}alpha(t){return this.checkConfig(),this._config.alpha=t,this}rotation(t){return this.checkConfig(),this._config.rotation=t,this}angle(t){return this.checkConfig(),this._config.angle=t,this}parentGroup(t){return this.checkConfig(),this._config.parentGroup=t,this}order(t){return this.checkConfig(),this._config.zOrder=t,this}zIndex(t){return this.checkConfig(),this._config.zIndex=t,this}sortable(t){return this.checkConfig(),this._config.sortableChildren=t,this}interactiveChildren(t){return this.checkConfig(),this._config.interactiveChildren=t,this}eventMode(t){return this.checkConfig(),this._config.interactive?this._config.interactive.eventMode=t:this._config.interactive={eventMode:t,emit:[]},this}eventType(t){return this.checkConfig(),this._config.interactive?this._config.interactive.emit.push(t):this._config.interactive={eventMode:"none",emit:[t]},this}cursor(t){return this.checkConfig(),this._config.interactive?this._config.interactive.cursor=t:this._config.interactive={cursor:t,emit:[],eventMode:"none"},this}interactive(t){return this.checkConfig(),this._config.interactive=t,this}hitArea(t){return this.checkConfig(),this._config.hitArea=t,this}mask(t){return this.checkConfig(),this._config.mask=t,this}addChild(t){var i;this.checkConfig(),this.checkChildren();const e=new b;return t(e),(i=this._config.children)==null||i.push(e.create()),this}getChild(t,e){var r;this.checkConfig(),this.checkChildren();const i=(r=this._config.children)==null?void 0:r.find(o=>o.name===t);if(!i)throw new Error(`Child with name ${t} not found`);const s=new b(i);return e(s),this}getDeepChild(t,e){this.checkConfig(),this.checkChildren();const i=this.deepSearchChild(t);if(!i)throw new Error(`Child with name ${t} not found`);const s=new b(i);return e(s),this}removeChild(t){var e;return this.checkConfig(),this.checkChildren(),this._config.children=(e=this._config.children)==null?void 0:e.filter(i=>i.name!==t),this}removeDeepChild(t){if(this.checkConfig(),this.checkChildren(),!this.deepRemoveChild(t,this._config.children||[]))throw new Error(`Child with name ${t} not found`);return this}anchor(t,e){if(this.checkConfig(),this.isSprite(this._config)||this.isText(this._config))this._config.anchor={x:t,y:e};else throw new Error("Anchor can only be set on Sprite or Text nodes");return this}texture(t){if(this.checkConfig(),this.isSprite(this._config)||this.isNineSlicePlane(this._config))this._config.asset=t;else throw new Error("Texture can only be set on Sprite or NineSlicePlane nodes");return this}tint(t){if(this.checkConfig(),this.isSprite(this._config)||this.isBitmapText(this._config)||this.isNineSlicePlane(this._config))this._config.tint=t;else throw new Error("Tint can only be set on Sprite, BitmapText or NineSlicePlane nodes");return this}text(t){if(this.checkConfig(),this.isText(this._config))this._config.text=t;else throw new Error("Text can only be set on Text nodes");return this}textStyle(t){if(this.checkConfig(),this.isText(this._config))this._config.textStyle=t;else throw new Error("Text style can only be set on Text nodes");return this}bitmapTextStyle(t){if(this.checkConfig(),this.isBitmapText(this._config))this._config.bitmapTextStyle=t;else throw new Error("Bitmap text style can only be set on BitmapText nodes");return this}spine(t){if(this.checkConfig(),this.isSpine(this._config))this._config.asset=t;else throw new Error("Spine can only be set on Spine nodes");return this}initialAnimation(t){if(this.checkConfig(),this.isSpine(this._config))this._config.initialAnimation=t;else throw new Error("Initial animation can only be set on Spine nodes");return this}skin(t){if(this.checkConfig(),this.isSpine(this._config))this._config.skin=t;else throw new Error("Skin can only be set on Spine nodes");return this}loop(t){if(this.checkConfig(),this.isSpine(this._config))this._config.loop=t;else throw new Error("Loop can only be set on Spine nodes");return this}timeScale(t){if(this.checkConfig(),this.isSpine(this._config))this._config.timeScale=t;else throw new Error("Time scale can only be set on Spine nodes");return this}nineSlice(t,e,i,s){if(this.checkConfig(),this.isNineSlicePlane(this._config))this._config.leftWidth=t,this._config.rightWidth=e,this._config.topHeight=i,this._config.bottomHeight=s;else throw new Error("Nine slice can only be set on NineSlicePlane nodes");return this}addComponent(t){return this.checkConfig(),this._config.entity||(this._config.entity={components:[]}),this._config.entity.components||(this._config.entity.components=[]),this._config.entity.components.push(t),this}removeComponent(t){return this.checkConfig(),this._config.entity||(this._config.entity={components:[]}),this._config.entity.components||(this._config.entity.components=[]),this._config.entity.components.findIndex(i=>i instanceof t)&&(this._config.entity.components=this._config.entity.components.filter(i=>i.constructor!==t)),this}create(){return this._config}checkConfig(){if(!this._config)throw new Error("Config is not initialized")}checkChildren(){this._config.children||(this._config.children=[])}deepSearchChild(t){const e=[...this._config.children||[]];let i;for(;e.length>0;){const s=e.shift();if(s){if(s.name===t){i=s,e.length=0;break}s.children&&e.push(...s.children)}}return i}deepRemoveChild(t,e){for(let i=0;i<e.length;i++){const s=e[i];if(s.name===t)return e.splice(i,1),!0;if(s.children)return this.deepRemoveChild(t,s.children)}return!1}isSprite(t){return t.type===u.Sprite}isText(t){return t.type===u.Text}isBitmapText(t){return t.type===u.BitmapText}isSpine(t){return t.type===V.Spine}isNineSlicePlane(t){return t.type===u.NineSlicePlane}}class Vt{constructor(t){this._builder=new b(t)}create(){return this.setup(this._builder),this._builder.create()}}class ht{constructor(t,e,i){this._factory=t,this._size=e,this._dynamic=i,this._pool=[],this.intitialize()}get size(){return this._size}get currentSize(){return this._pool.length}intitialize(){for(let t=0;t<this._size;++t){const e=this._factory.create();this._pool.push(e)}}get(){if(!this._pool.length&&!this._dynamic)throw new Error("No more items in pool");let t;return this._pool.length&&(t=this._pool.pop()),!t&&this._dynamic&&(t=this._factory.create()),t}release(t){this._factory.reset(t),this._pool.push(t)}}class Ht{createFromConfig(t){return this.config=t,l.ServiceContainer.instance.get(R).create(t)}}class Y{constructor(){this._pools=new Map}create(t,e,i,s){const r=new e,o=new ht(r,i,s);return this._pools.set(t,o),o}get(t){let e=this._pools.get(t);if(!e)throw Error(`No pool with name ${t} found`);return e}}class y{constructor(){this.tag=-1,this.originalTarget=null,this.target=null}clone(){const t=new y;return t.originalTarget=null,t.target=null,t}isDone(){return!0}startWithTarget(t){this.originalTarget=t,this.target=t}stop(){this.target=null}step(t){}update(t){}getTarget(){return this.target}setTarget(t){this.target=t}getOriginalTarget(){return this.originalTarget}setOriginalTarget(t){this.originalTarget=t}reverse(){return null}retain(){}release(){}}class q extends y{constructor(){super(...arguments),this._duration=0,this._timesForRepeat=1}getDuration(){return this._duration*(this._timesForRepeat||1)}setDuration(t){this._duration=t}clone(){return new q}}class B extends q{isDone(){return!0}step(t){this.update(1)}update(t){}reverse(){return this.clone()}clone(){return new B}}const Xt=1192092896e-16;class f extends q{constructor(t){super(),this.MAX_VALUE=2,this._elapsed=0,this._firstTick=!1,this._easeList=[],this._speed=1,this._repeatForever=!1,this._repeatMethod=!1,this._speedMethod=!1,t!==void 0&&!Number.isNaN(t)&&this.initWithDuration(t)}getElapsed(){return this._elapsed}initWithDuration(t){return this._duration=t===0?Xt:t,this._elapsed=0,this._firstTick=!0,!0}isDone(){return this._elapsed>=this._duration}clone(){const t=new f(this._duration);return this.cloneDecoration(t),t}easing(t){this._easeList?this._easeList.length=0:this._easeList=[];for(let e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this}step(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;let e=this._elapsed/(this._duration>1192092896e-16?this._duration:1192092896e-16);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))}startWithTarget(t){y.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0}reverse(){return this}setAmplitudeRate(t){}getAmplitudeRate(){return 0}speed(t){return t<=0?this:(this._speedMethod=!0,this._speed*=t,this)}getSpeed(){return this._speed}setSpeed(t){return this._speed=t,this}repeat(t){return t=Math.round(t),Number.isNaN(t)||t<1?this:(this._repeatMethod=!0,this._timesForRepeat*=t,this)}repeatForever(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this}cloneDecoration(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod}reverseEaseList(t){if(this._easeList){t._easeList=[];for(let e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}}computeEaseTime(t){return t}}class J extends B{constructor(t,e,i){super(),this._selectorTarget=null,this._function=null,this._data=null,this.initWithFunction(t,e,i)}initWithFunction(t,e,i){return t&&(this._function=t),e&&(this._selectorTarget=e),i!==void 0&&(this._data=i),!0}execute(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)}update(t){this.execute()}getTargetCallback(){return this._selectorTarget}setTargetCallback(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)}clone(){const t=new J;return t.initWithFunction(this._function,this._selectorTarget,this._data),t}}const A=class A extends f{constructor(t){super(),this._actions=[],this._split=0,this._last=0,this._reversed=!1;const e=t instanceof Array?t:arguments;if(e.length===1)return;const i=e.length-1;if(i>=0){let s=e[0],r;for(let o=1;o<i;o++)e[o]&&(r=s,s=A._actionOneTwo(r,e[o]));this.initWithTwoActions(s,e[i])}}initWithTwoActions(t,e){if(!t||!e)return!1;let i=t._duration,s=e._duration;i*=t._repeatMethod?t._timesForRepeat:1,s*=e._repeatMethod?e._timesForRepeat:1;const r=i+s;return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0}clone(){const t=new A;return this.cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t}startWithTarget(t){f.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1}stop(){this._last!==-1&&this._actions[this._last].stop(),y.prototype.stop.call(this)}update(t){let e,i=0;const s=this._split,r=this._actions,o=this._last;let c;t=this.computeEaseTime(t),t<s?(e=s!==0?t/s:1,i===0&&o===1&&this._reversed&&(r[1].update(0),r[1].stop())):(i=1,e=s===1?1:(t-s)/(1-s),o===-1&&(r[0].startWithTarget(this.target),r[0].update(1),r[0].stop()),o===0&&(r[0].update(1),r[0].stop())),c=r[i],!(o===i&&c.isDone())&&(o!==i&&c.startWithTarget(this.target),e*=c._timesForRepeat,c.update(e>1?e%1:e),this._last=i)}reverse(){const t=A._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this.cloneDecoration(t),this.reverseEaseList(t),t._reversed=!0,t}};A._actionOneTwo=function(t,e){const i=new A;return i.initWithTwoActions(t,e),i};let P=A;function Q(n){const t=n instanceof Array?n:arguments;if(t.length===1)return t[0];const e=t.length-1;let i=null;if(e>=0){i=t[0];for(let s=1;s<=e;s++)t[s]&&(i=P._actionOneTwo(i,t[s]))}return i}class z extends f{constructor(t,e){super(),this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null,e!==void 0&&this.initWithAction(t,e)}initWithAction(t,e){const i=t._duration*e;return this.initWithDuration(i)?(this._times=e,this._innerAction=t,t instanceof B&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1}clone(){const t=new z;return this.cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t}startWithTarget(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,f.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)}stop(){this._innerAction.stop(),y.prototype.stop.call(this)}update(t){t=this.computeEaseTime(t);const e=this._innerAction,i=this._duration,s=this._times;let r=this._nextDt;if(t>=r){for(;t>r&&this._total<s;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/i,this._nextDt=r>1?1:r;t>=1&&this._total<s&&(e.update(1),this._total++),this._actionInstant||(this._total===s?e.stop():e.update(t-(r-e._duration/i)))}else e.update(t*s%1)}isDone(){return this._total===this._times}reverse(){const t=new z(this._innerAction.reverse(),this._times);return this.cloneDecoration(t),this.reverseEaseList(t),t}setInnerAction(t){this._innerAction!==t&&(this._innerAction=t)}getInnerAction(){return this._innerAction}}class N extends f{constructor(t){super(),this._innerAction=null,t&&this.initWithAction(t)}initWithAction(t){return t?(this._innerAction=t,!0):!1}clone(){const t=new N;return this.cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t}startWithTarget(t){f.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)}step(t){const e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))}isDone(){return!1}reverse(){const t=new N(this._innerAction.reverse());return this.cloneDecoration(t),this.reverseEaseList(t),t}setInnerAction(t){this._innerAction!==t&&(this._innerAction=t)}getInnerAction(){return this._innerAction}}class M extends f{update(t){}reverse(){const t=new M(this._duration);return this.cloneDecoration(t),this.reverseEaseList(t),t}clone(){const t=new M;return this.cloneDecoration(t),t.initWithDuration(this._duration),t}}const S=class S extends f{constructor(t){super(),this._one=null,this._two=null;const e=t instanceof Array?t:arguments;if(e.length===1)return;const i=e.length-1;if(i>=0){let s=e[0],r;for(let o=1;o<i;o++)e[o]&&(r=s,s=S._actionOneTwo(r,e[o]));this.initWithTwoActions(s,e[i])}}initWithTwoActions(t,e){if(!t||!e)return!1;let i=!1;const s=t._duration,r=e._duration;return this.initWithDuration(Math.max(s,r))&&(this._one=t,this._two=e,s>r?this._two=P._actionOneTwo(e,new M(s-r)):s<r&&(this._one=P._actionOneTwo(t,new M(r-s))),i=!0),i}clone(){const t=new S;return this.cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t}startWithTarget(t){f.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)}stop(){this._one.stop(),this._two.stop(),y.prototype.stop.call(this)}update(t){t=this.computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)}reverse(){const t=S._actionOneTwo(this._one.reverse(),this._two.reverse());return this.cloneDecoration(t),this.reverseEaseList(t),t}};S._actionOneTwo=function(t,e){const i=new S;return i.initWithTwoActions(t,e),i};let Z=S;function lt(n){const t=n instanceof Array?n:arguments;if(t.length===1)return null;let e=t[0];for(let i=1;i<t.length;i++)t[i]!=null&&(e=Z._actionOneTwo(e,t[i]));return e}class k extends f{constructor(t){super(),this._other=null,t&&this.initWithAction(t)}initWithAction(t){return!t||t===this._other?!1:f.prototype.initWithDuration.call(this,t._duration)?(this._other=t,!0):!1}clone(){const t=new k;return this.cloneDecoration(t),t.initWithAction(this._other.clone()),t}startWithTarget(t){f.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)}update(t){t=this.computeEaseTime(t),this._other&&this._other.update(1-t)}reverse(){return this._other.clone()}stop(){this._other.stop(),y.prototype.stop.call(this)}}class Yt{constructor(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1}}class Jt{constructor(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}addAction(t,e,i){if(!t||!e)return;let s=this._hashTargets.get(e);s?s.actions||(s.actions=[]):(s=this._getElement(e,i),this._hashTargets.set(e,s),this._arrayTargets.push(s)),s.target=e,s.actions.push(t),t.startWithTarget(e)}removeAllActions(){const t=this._arrayTargets;for(let e=0;e<t.length;e++){const i=t[e];i&&this._putElement(i)}this._arrayTargets.length=0,this._hashTargets=new Map}removeAllActionsFromTarget(t){if(t==null)return;const e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}removeAction(t){if(t==null)return;const e=t.getOriginalTarget(),i=this._hashTargets.get(e);if(i){for(let s=0;s<i.actions.length;s++)if(i.actions[s]===t){i.actions.splice(s,1),i.actionIndex>=s&&i.actionIndex--;break}}}_removeActionByTag(t,e,i){for(let s=0,r=e.actions.length;s<r;++s){const o=e.actions[s];if(o&&o.tag===t){if(i&&o.getOriginalTarget()!==i)continue;this._removeActionAtIndex(s,e);break}}}_removeAllActionsByTag(t,e,i){for(let s=e.actions.length-1;s>=0;--s){const r=e.actions[s];if(r&&r.tag===t){if(i&&r.getOriginalTarget()!==i)continue;this._removeActionAtIndex(s,e)}}}removeActionByTag(t,e){const i=this._hashTargets;if(e){const s=i.get(e);s&&this._removeActionByTag(t,s,e)}else i.forEach(s=>{this._removeActionByTag(t,s)})}removeAllActionsByTag(t,e){const i=this._hashTargets;if(e){const s=i.get(e);s&&this._removeAllActionsByTag(t,s,e)}else i.forEach(s=>{this._removeAllActionsByTag(t,s)})}getActionByTag(t,e){const i=this._hashTargets.get(e);if(i&&i.actions!=null)for(let s=0;s<i.actions.length;++s){const r=i.actions[s];if(r&&r.tag===t)return r}return null}getNumberOfRunningActionsInTarget(t){const e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0}pauseTarget(t){const e=this._hashTargets.get(t);e&&(e.paused=!0)}resumeTarget(t){const e=this._hashTargets.get(t);e&&(e.paused=!1)}pauseAllRunningActions(){const t=[],e=this._arrayTargets;for(let i=0;i<e.length;i++){const s=e[i];s&&!s.paused&&(s.paused=!0,t.push(s.target))}return t}resumeTargets(t){if(t)for(let e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])}pauseTargets(t){if(t)for(let e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])}_removeActionAtIndex(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,e.actions.length===0&&this._deleteHashElement(e)}update(t){const e=this._arrayTargets;let i;for(let s=0;s<e.length;s++){if(this._currentTarget=e[s],i=this._currentTarget,!i.paused&&i.actions){for(i.lock=!0,i.actionIndex=0;i.actionIndex<i.actions.length;i.actionIndex++)if(i.currentAction=i.actions[i.actionIndex],!!i.currentAction){if(i.currentAction.step(t*(this._isActionInternal(i.currentAction)?i.currentAction.getSpeed():1)),i.currentAction&&i.currentAction.isDone()){i.currentAction.stop();const r=i.currentAction;i.currentAction=null,this.removeAction(r)}i.currentAction=null}i.lock=!1}i.actions.length===0&&this._deleteHashElement(i)&&s--}}_getElement(t,e){let i=this._elementPool.pop();return i||(i=new Yt),i.target=t,i.paused=!!e,i}_putElement(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)}_deleteHashElement(t){let e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);const i=this._arrayTargets;for(let s=0,r=i.length;s<r;s++)if(i[s]===t){i.splice(s,1);break}this._putElement(t),e=!0}return e}_isActionInternal(t){return typeof t._speedMethod<"u"}}const G=class G{constructor(){this.actionMgr=new Jt}static get instance(){return this._instance||(this._instance=new G),this._instance}get ActionManager(){return this.actionMgr}update(t){this.actionMgr.update(t)}};G._instance=null;let p=G;const Qt=()=>0,Zt=n=>n,ut=n=>n*n,ft=n=>n*(2-n),kt=n=>(n*=2,n<1?.5*n*n:-.5*(--n*(n-2)-1)),dt=n=>n*n*n,gt=n=>--n*n*n+1,Kt=n=>(n*=2,n<1?.5*n*n*n:.5*((n-=2)*n*n+2)),_t=n=>n*n*n*n,pt=n=>1- --n*n*n*n,jt=n=>(n*=2,n<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)),mt=n=>n*n*n*n*n,wt=n=>--n*n*n*n*n+1,te=n=>(n*=2,n<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)),yt=n=>n===1?1:1-Math.cos(n*Math.PI/2),vt=n=>Math.sin(n*Math.PI/2),ee=n=>.5*(1-Math.cos(Math.PI*n)),At=n=>n===0?0:Math.pow(1024,n-1),St=n=>n===1?1:1-Math.pow(2,-10*n),ie=n=>n===0?0:n===1?1:(n*=2,n<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)),Tt=n=>1-Math.sqrt(1-n*n),Ct=n=>Math.sqrt(1- --n*n),se=n=>(n*=2,n<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)),bt=n=>{let t,e=.1;const i=.4;return n===0?0:n===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/i)))},Mt=n=>{let t,e=.1;const i=.4;return n===0?0:n===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*n)*Math.sin((n-t)*(2*Math.PI)/i)+1)},ne=n=>{let t,e=.1;const i=.4;return n===0?0:n===1?1:(!e||e<1?(e=1,t=i/4):t=i*Math.asin(1/e)/(2*Math.PI),n*=2,n<1?-.5*(e*Math.pow(2,10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/i)):e*Math.pow(2,-10*(n-=1))*Math.sin((n-t)*(2*Math.PI)/i)*.5+1)},It=n=>n===1?1:n*n*((1.70158+1)*n-1.70158),xt=n=>n===0?0:--n*n*((1.70158+1)*n+1.70158)+1,re=n=>{const t=2.5949095;return n*=2,n<1?.5*(n*n*((t+1)*n-t)):.5*((n-=2)*n*((t+1)*n+t)+2)},K=n=>1-$(1-n),$=n=>n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375,oe=n=>n<.5?K(n*2)*.5:$(n*2-1)*.5+.5,ae=n=>n<=0?0:n*n*(3-2*n),ce=n=>n<=0?0:n*n*n*(n*(n*6-15)+10),m=(n,t)=>e=>e<.5?t(e*2)/2:n(2*e-1)/2+.5,he=m(ut,ft),le=m(dt,gt),ue=m(_t,pt),fe=m(mt,wt),de=m(yt,vt),ge=m(At,St),_e=m(Tt,Ct),pe=m(bt,Mt),me=m(It,xt),we=m(K,$),Et=Object.freeze(Object.defineProperty({__proto__:null,backIn:It,backInOut:re,backOut:xt,backOutIn:me,bounceIn:K,bounceInOut:oe,bounceOut:$,bounceOutIn:we,circIn:Tt,circInOut:se,circOut:Ct,circOutIn:_e,constant:Qt,cubicIn:dt,cubicInOut:Kt,cubicOut:gt,cubicOutIn:le,elasticIn:bt,elasticInOut:ne,elasticOut:Mt,elasticOutIn:pe,expoIn:At,expoInOut:ie,expoOut:St,expoOutIn:ge,fade:ce,linear:Zt,quadIn:ut,quadInOut:kt,quadOut:ft,quadOutIn:he,quartIn:_t,quartInOut:jt,quartOut:pt,quartOutIn:ue,quintIn:mt,quintInOut:te,quintOut:wt,quintOutIn:fe,sineIn:yt,sineInOut:ee,sineOut:vt,sineOutIn:de,smooth:ae},Symbol.toStringTag,{value:"Module"})),ye=n=>{const t=n.charAt(0);if(/[A-Z]/.test(t)){n=n.replace(t,t.toLowerCase());const e=n.split("-");if(e.length===2){const i=e[0];if(i==="linear")n="linear";else{const s=e[1];switch(i){case"quadratic":n=`quad${s}`;break;case"quartic":n=`quart${s}`;break;case"quintic":n=`quint${s}`;break;case"sinusoidal":n=`sine${s}`;break;case"exponential":n=`expo${s}`;break;case"circular":n=`circ${s}`;break;default:n=i+s;break}}}}return n};class O extends f{constructor(t,e,i){if(super(),i==null)i=Object.create(null);else if(i.easing&&typeof i.easing=="string"&&(i.easing=ye(i.easing)),i.progress||(i.progress=this.progress),i.easing&&typeof i.easing=="string"){const s=i.easing;i.easing=Et[s]}this._opts=i,this._props=Object.create(null);for(const s in e){if(!e.hasOwnProperty(s))continue;let r=e[s];if(typeof r=="function"&&(r=r()),r==null||typeof r=="string")continue;let o,c;r.value!==void 0&&(r.easing||r.progress)&&(typeof r.easing=="string"?o=Et[r.easing]:o=r.easing,c=r.progress,r=r.value);const a=Object.create(null);a.value=r,a.easing=o,a.progress=c,this._props[s]=a}this._originProps=e,this.initWithDuration(t)}clone(){const t=new O(this._duration,this._originProps,this._opts);return this.cloneDecoration(t),t}startWithTarget(t){f.prototype.startWithTarget.call(this,t);const e=!!this._opts.relative,i=this._props;for(const s in i){const r=t[s];if(r===void 0)continue;const o=i[s],c=o.value;if(typeof r=="number")o.start=r,o.current=r,o.end=e?r+c:c;else if(typeof r=="object"){o.start==null&&(o.start={},o.current={},o.end={});for(const a in c)isNaN(r[a])||(o.start[a]=r[a],o.current[a]=r[a],o.end[a]=e?r[a]+c[a]:c[a])}}this._opts.onStart&&this._opts.onStart(this.target)}update(t){const e=this.target;if(!e)return;const i=this._props,s=this._opts;let r=t;s.easing&&(r=s.easing(t));const o=s.progress;for(const c in i){const a=i[c],w=a.easing?a.easing(t):r,d=a.progress?a.progress:o,_=a.start,D=a.end;if(typeof _=="number")a.current=d(_,D,a.current,w);else if(typeof _=="object")for(const v in _)a.current[v]=d(_[v],D[v],a.current[v],w);e[c]=a.current}s.onUpdate&&s.onUpdate(this.target,t),t===1&&s.onComplete&&s.onComplete(this.target)}progress(t,e,i,s){return t+(e-t)*s}}class j extends B{constructor(t){super(),this._props={},t!==void 0&&this.init(t)}init(t){for(const e in t)this._props[e]=t[e];return!0}update(){const t=this._props,e=this.target;for(const i in t)e[i]=t[i]}clone(){const t=new j;return t.init(this._props),t}}const g=class g{constructor(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=-1,this._target=t===void 0?null:t}set tag(t){this._tag=t}then(t){return t instanceof y?this._actions.push(t.clone()):this._actions.push(t._union()),this}target(t){return this._target=t,this}start(){return this._target?(this._finalAction&&p.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.tag=this._tag,p.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(console.warn("Please set target to tween first"),this)}stop(){return this._finalAction&&p.instance.ActionManager.removeAction(this._finalAction),this}clone(t){const e=this._union();return new g(t).then(e.clone())}union(){const t=this._union();return this._actions.length=0,this._actions.push(t),this}to(t,e,i){i=i||Object.create(null),i.relative=!1;const s=new O(t,e,i);return this._actions.push(s),this}from(t,e,i){i=i||Object.create(null),i.relative=!0;const s=new O(t,e,i);return this._actions.push(s),this}set(t){const e=new j(t);return this._actions.push(e),this}delay(t){const e=new M(t);return this._actions.push(e),this}call(t){const e=new J(t);return this._actions.push(e),this}sequence(...t){const e=g._wrappedSequence(...t);return this._actions.push(e),this}parallel(...t){const e=g._wrappedParallel(...t);return this._actions.push(e),this}repeat(t,e){if(t===1/0)return this.repeatForever(e);const i=this._actions;let s;e instanceof g?s=e._union():s=i.pop();const r=new z(s,t);return i.push(r),this}repeatForever(t){const e=this._actions;let i;t instanceof g?i=t._union():i=e.pop();const s=new N(i);return e.push(s),this}reverseTime(t){const e=this._actions;let i;t instanceof g?i=t._union():i=e.pop();const s=new k(i);return e.push(s),this}static stopAll(){p.instance.ActionManager.removeAllActions()}static stopAllByTag(t,e){p.instance.ActionManager.removeAllActionsByTag(t,e)}static stopAllByTarget(t){p.instance.ActionManager.removeAllActionsFromTarget(t)}_union(){const t=this._actions;let e;return t.length===1?e=t[0]:e=Q(t),e}static _wrappedSequence(...t){const e=g._tmp_args;e.length=0;for(let i=t.length,s=0;s<i;s++){const r=e[s]=t[s];r instanceof g&&(e[s]=r._union())}return Q.apply(Q,e)}static _wrappedParallel(...t){const e=g._tmp_args;e.length=0;for(let i=t.length,s=0;s<i;s++){const r=e[s]=t[s];r instanceof g&&(e[s]=r._union())}return lt.apply(lt,e)}};g._tmp_args=[];let tt=g;class ve{constructor(t){this._viewBuilder=t}init(t){return this._view=this._viewBuilder.create(this.setup(),t),this._view}destroy(){this._view.destroy({children:!0})}}class et{constructor(t,e,i){this._pixi=t,this._viewBuilder=e,this._layers=i}setScene(t){var s;const e=this._pixi.stage.getChildByName("Scene");if(!e)return;(s=this._currentScene)==null||s.destroy();const i=new t(this._viewBuilder);i.init(e),this._currentScene=i,this._layers.sortAll()}addLayer(t){this._layers.createGroups(t.name,t.order||0,t.sortable||!1)}setShared(t){const e=this._pixi.stage.getChildByName("Shared");e.removeChildren(),this._viewBuilder.create(t,e)}removeFromShared(t){const i=this._pixi.stage.getChildByName("Shared").getChildByName(t,!0);i&&i.destroy({children:!0})}}class it{constructor(t,e,i){this._lifecycle=t,this._executionController=e,this._spineController=i,this._paused=!1,this._gameSpeed=1}get paused(){return this._paused}get gameSpeed(){return this._gameSpeed}pause(){this._paused=!0,this._lifecycle.pause(this._paused),this._executionController.pauseAll(),this._spineController.pauseAll()}resume(){this._paused=!1,this._lifecycle.pause(this._paused),this._executionController.resumeAll(),this._spineController.resumeAll()}setGameSpeed(t){this._gameSpeed=t,this._lifecycle.setSpeedMultiplier(this._gameSpeed),this._spineController.multyplyTimeScaleAll(this._gameSpeed)}}class st{constructor(t){this._viewBuilder=t,this._prefabs=new Map}register(t){this._prefabs.set(t,t)}replace(t,e){this._prefabs.set(t,e)}get(t){const e=this._prefabs.get(t);if(!e)throw new Error(`Prefab ${t.name} not found`);return e}create(t,e){const i=t.create();return this._viewBuilder.create(i,e)}}class Ae extends l.EmpressCore{connectRender(t,e){this.registerGlobalServices([{provide:u.Application,useFactory:()=>t}]),this.appendToDOM(t,e),this.connectDebugger(t)}init(){super.init();const t=l.ServiceContainer.instance.get(u.Application);this.initializeDependencies(t);const e=l.ServiceContainer.instance.get(l.LifeCycle),i=l.ServiceContainer.instance.get(W);this.createStage(t),this.createRootView("Scene",t),this.createRootView("Shared",t),e.addUpdateCallback(s=>this.update(s,i))}update(t,e){e.update(t),p.instance.update(t)}appendToDOM(t,e){e.appendChild(t.view)}connectDebugger(t){globalThis.__PIXI_APP__=t}initializeDependencies(t){const e=new C,i=new R(e),s=new st(i),r=new L,o=new H(e),c=new x,a=new W,w=new F,d=new X,_=new Y,D=new et(t,i,c),v=l.ServiceContainer.instance.get(l.LifeCycle),I=l.ServiceContainer.instance.get(l.ExecutionController),Se=new it(v,I,w);this.registerGlobalServices([{provide:C,useFactory:()=>e},{provide:R,useFactory:()=>i},{provide:st,useFactory:()=>s},{provide:L,useFactory:()=>r},{provide:H,useFactory:()=>o},{provide:x,useFactory:()=>c},{provide:W,useFactory:()=>a},{provide:F,useFactory:()=>w},{provide:X,useFactory:()=>d},{provide:Y,useFactory:()=>_},{provide:et,useFactory:()=>D},{provide:it,useFactory:()=>Se}])}createStage(t){const e=l.ServiceContainer.instance.get(x),i=new Pt.Stage;i.sortableChildren=!0,t.stage=i,t.stage.x=t.view.width/2,t.stage.y=t.view.height/2,e.setStage(i),e.sortAll()}createRootView(t,e){const i=new u.Container;i.name=t,e.stage.addChild(i)}}h.Asset=ct,h.AssetStatus=E,h.AssetsManager=C,h.EmpressPixiCore=Ae,h.FlowController=it,h.Layers=x,h.Loader=H,h.NodeBuilder=b,h.ObjectPool=ht,h.OnElementInteractSignal=at,h.OnViewCreatedSignal=rt,h.ParticleEmitter=W,h.PixiEntity=ot,h.PixiItemPoolFactory=Ht,h.PoolsController=Y,h.PrefabService=st,h.Scene=ve,h.SceneController=et,h.SpineController=F,h.SpineUtils=X,h.Tween=tt,h.TweenAction=O,h.TweenSystem=p,h.View=Vt,h.ViewBuilder=R,h.ViewEntity=L,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
